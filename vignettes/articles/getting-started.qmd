---
title: "Getting Started with medfit"
format: html
execute:
  collapse: true
  comment: "#>"
  eval: true
---

```{r}
#| label: setup
#| include: false
library(medfit)
```

## What is medfit?

**medfit** provides unified infrastructure for mediation analysis in R. It offers:

- **S7-based classes** for standardized mediation data structures
- **Generic functions** for model fitting, extraction, and inference
- **Foundation** for specialized mediation packages (probmed, RMediation, medrobust)

## Quick Start

### Fit Mediation Models

The easiest way to analyze mediation is with `fit_mediation()`:

```{r}
#| label: fit-med
# Generate example data
set.seed(123)
n <- 200
X <- rnorm(n)
M <- 0.5 * X + rnorm(n)
Y <- 0.3 * M + 0.2 * X + rnorm(n)
data <- data.frame(X = X, M = M, Y = Y)

# Fit mediation models with one call
med_data <- fit_mediation(
  formula_y = Y ~ X + M,
  formula_m = M ~ X,
  data = data,
  treatment = "X",
  mediator = "M"
)

# View the object
print(med_data)
```

### Compute Indirect Effect

```{r}
#| label: indirect
# Indirect effect = a * b
med_data@a_path * med_data@b_path
```

### Bootstrap Confidence Intervals

```{r}
#| label: bootstrap
# Define indirect effect function
indirect_fn <- function(theta) {
  theta["m_X"] * theta["y_M"]
}

# Parametric bootstrap
boot_result <- bootstrap_mediation(
  statistic_fn = indirect_fn,
  method = "parametric",
  mediation_data = med_data,
  n_boot = 1000,
  ci_level = 0.95,
  seed = 123
)

print(boot_result)
```

### Extract from Pre-Fitted Models

If you already have fitted models, use `extract_mediation()`:
```{r}
#| label: extract
# Fit models separately
fit_m <- lm(M ~ X, data = data)
fit_y <- lm(Y ~ X + M, data = data)

# Extract mediation structure
med_data2 <- extract_mediation(
  fit_m,
  model_y = fit_y,
  treatment = "X",
  mediator = "M"
)

print(med_data2)
```

### Create Objects Directly

You can also create mediation objects directly for analysis:

```{r}
#| label: create-med
# Simple mediation: X -> M -> Y
med_data_direct <- MediationData(
  a_path = 0.5,           # X -> M effect
  b_path = 0.3,           # M -> Y effect (controlling for X)
  c_prime = 0.2,          # X -> Y direct effect
  treatment = "X",
  mediator = "M",
  outcome = "Y",
  estimates = c(m_intercept = 0, m_X = 0.5, y_intercept = 0, y_X = 0.2, y_M = 0.3),
  vcov = diag(5) * 0.01,
  sigma_m = 1.0,
  sigma_y = 1.0,
  mediator_predictors = "X",
  outcome_predictors = c("X", "M"),
  n_obs = 100L,
  converged = TRUE,
  source_package = "medfit"
)

print(med_data_direct)
```

### Serial Mediation

For serial mediation (X -> M1 -> M2 -> Y):

```{r}
#| label: serial
serial_data <- SerialMediationData(
  a_path = 0.4,           # X -> M1
  d_path = 0.5,           # M1 -> M2
  b_path = 0.3,           # M2 -> Y
  c_prime = 0.2,          # X -> Y direct effect
  treatment = "X",
  mediators = c("M1", "M2"),
  outcome = "Y",
  estimates = c(a = 0.4, d = 0.5, b = 0.3, c_prime = 0.2),
  vcov = diag(4) * 0.01,
  sigma_mediators = c(1.0, 1.0),
  sigma_y = 1.0,
  mediator_predictors = list(M1 = "X", M2 = c("X", "M1")),
  outcome_predictors = c("X", "M1", "M2"),
  n_obs = 100L,
  converged = TRUE,
  source_package = "medfit"
)

# Serial indirect effect = a * d * b
serial_data@a_path * serial_data@d_path * serial_data@b_path
```

## Main Functions

medfit provides three main functions:
1. **`fit_mediation()`** - Fit mediation models directly
2. **`extract_mediation()`** - Extract mediation structure from fitted models (lm/glm, lavaan)
3. **`bootstrap_mediation()`** - Bootstrap inference for confidence intervals

## Learn More

- [Introduction to medfit](introduction.html) - Detailed S7 class documentation
- [Model Extraction](extraction.html) - Extract from lm, glm, lavaan models
- [Bootstrap Inference](bootstrap.html) - Parametric and nonparametric bootstrap

## Development Status

medfit is in Phase 6 (Extended Testing):

- âœ… Phase 1-2: S7 class architecture
- âœ… Phase 3: Model extraction (lm/glm, lavaan)
- âœ… Phase 4: Model fitting (GLM engine)
- âœ… Phase 5: Bootstrap infrastructure
- âœ… Phase 6: Extended testing
- ðŸ“‹ Phase 7: Polish & release

See `NEWS.md` for the latest updates.
