---
title: "Getting Started with medfit"
format: html
execute:
  collapse: true
  comment: "#>"
  eval: false
---

## What is medfit?

**medfit** provides unified infrastructure for mediation analysis in R. It offers:

- **S7-based classes** for standardized mediation data structures
- **Generic functions** for model fitting, extraction, and inference
- **Foundation** for specialized mediation packages (probmed, RMediation, medrobust)

## Quick Start

### Create a Mediation Data Object

```{r}
#| label: create-med
# Simple mediation: X -> M -> Y
med_data <- MediationData(
  a_path = 0.5,           # X -> M effect
  b_path = 0.3,           # M -> Y effect (controlling for X)
  c_prime = 0.2,          # X -> Y direct effect
  treatment = "X",
  mediator = "M",
  outcome = "Y",
  estimates = c(a = 0.5, b = 0.3, c_prime = 0.2),
  vcov = diag(3) * 0.01,  # Covariance matrix
  n_obs = 100L,
  converged = TRUE,
  source_package = "medfit"
)

# View the object
print(med_data)
```

### Compute Indirect Effect

```{r}
#| label: indirect
# Indirect effect = a * b
med_data@a_path * med_data@b_path
```

### Serial Mediation

For serial mediation (X -> M1 -> M2 -> Y):

```{r}
#| label: serial
serial_data <- SerialMediationData(
  a_path = 0.4,           # X -> M1
  d_path = 0.5,           # M1 -> M2
  b_path = 0.3,           # M2 -> Y
  c_prime = 0.2,          # X -> Y direct effect
  treatment = "X",
  mediators = c("M1", "M2"),
  outcome = "Y",
  estimates = c(a = 0.4, d = 0.5, b = 0.3, c_prime = 0.2),
  vcov = diag(4) * 0.01,
  mediator_predictors = list(M1 = "X", M2 = c("X", "M1")),
  outcome_predictors = c("X", "M1", "M2"),
  n_obs = 100L,
  converged = TRUE,
  source_package = "medfit"
)

# Serial indirect effect = a * d * b
serial_data@a_path * serial_data@d_path * serial_data@b_path
```

## Main Functions

medfit provides three main functions:

### 1. fit_mediation() - Fit Models Directly

The easiest way to get started:

```{r}
#| label: fit-mediation
library(medfit)

# Create example data
set.seed(123)
n <- 200
X <- rnorm(n)
M <- 0.5 * X + rnorm(n)
Y <- 0.3 * X + 0.4 * M + rnorm(n)
mydata <- data.frame(X = X, M = M, Y = Y)

# Fit mediation model
med <- fit_mediation(
  formula_y = Y ~ X + M,
  formula_m = M ~ X,
  data = mydata,
  treatment = "X",
  mediator = "M"
)

# View results
print(med)

# Access path coefficients
med@a_path  # X -> M
med@b_path  # M -> Y
med@c_prime # X -> Y (direct)

# Indirect effect
med@a_path * med@b_path
```

### 2. extract_mediation() - Extract from Fitted Models

If you already have fitted models:

```{r}
#| label: extract-mediation
# Fit models separately
fit_m <- lm(M ~ X, data = mydata)
fit_y <- lm(Y ~ X + M, data = mydata)

# Extract mediation structure
med <- extract_mediation(
  fit_m,
  model_y = fit_y,
  treatment = "X",
  mediator = "M"
)
```

### 3. bootstrap_mediation() - Bootstrap Inference

Compute confidence intervals:

```{r}
#| label: bootstrap-mediation
# Define statistic function
indirect_effect <- function(theta) {
  theta["m_X"] * theta["y_M"]
}

# Bootstrap CI
boot_result <- bootstrap_mediation(
  statistic_fn = indirect_effect,
  method = "parametric",
  mediation_data = med,
  n_boot = 1000,
  ci_level = 0.95,
  seed = 123
)

print(boot_result)
```

## Learn More

- [Introduction to medfit](introduction.html) - Detailed S7 class documentation
- [Model Extraction](extraction.html) - Extract from lm, glm, lavaan models
- [Bootstrap Inference](bootstrap.html) - Parametric and nonparametric bootstrap

## Development Status

medfit is under active development:

- ✅ Phase 2 Complete: S7 class architecture
- ✅ Phase 3 Complete: Model extraction (lm/glm, lavaan)
- ✅ Phase 4 Complete: Model fitting (`fit_mediation()`)
- ✅ Phase 5 Complete: Bootstrap infrastructure (`bootstrap_mediation()`)

See `NEWS.md` for the latest updates.
